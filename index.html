<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CalFit Ai</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800;900&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{--o:#FF5722;--o2:#FF7043;--o3:#FF8A65;--dark:#0F0F0F;--card:#161616;--card2:#1C1C1C;--border:#252525;--text:#F0F0F0;--muted:#666;--glass:rgba(255,255,255,0.05);}
body{background:#0F0F0F;font-family:'Nunito',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;}
.phone{width:390px;height:844px;background:#0F0F0F;border-radius:50px;box-shadow:0 50px 120px rgba(0,0,0,0.85),0 0 0 1px rgba(255,255,255,0.07);overflow:hidden;position:relative;display:flex;flex-direction:column;}

/* ANIMATIONS */
.screen{flex:1;display:flex;flex-direction:column;animation:sIn .38s cubic-bezier(.22,1,.36,1) both;overflow:hidden;}
@keyframes sIn{from{opacity:0;transform:translateX(26px)}to{opacity:1;transform:translateX(0)}}
@keyframes fUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes pop{from{transform:scale(.75);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,87,34,0.3)}50%{box-shadow:0 0 40px rgba(255,87,34,0.6)}}

/* BUTTONS */
.btn-main{width:100%;padding:17px;background:linear-gradient(135deg,var(--o),var(--o2));color:#fff;border:none;border-radius:16px;font-family:'Nunito',sans-serif;font-size:15px;font-weight:800;cursor:pointer;box-shadow:0 6px 24px rgba(255,87,34,0.35);transition:.2s;letter-spacing:.2px;}
.btn-main:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(255,87,34,0.45);}
.btn-main:active{transform:translateY(0);}
.btn-main:disabled{background:#1E1E1E;color:#333;box-shadow:none;cursor:not-allowed;transform:none;}
.btn-ghost{width:100%;padding:15px;background:var(--glass);color:var(--text);border:1px solid var(--border);border-radius:16px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:.2s;margin-top:10px;}
.btn-ghost:hover{background:rgba(255,255,255,0.08);}
.btn-sm{padding:9px 18px;background:linear-gradient(135deg,var(--o),var(--o2));color:#fff;border:none;border-radius:12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:.2s;}
.btn-sm:hover{transform:translateY(-1px);}
.btn-danger{width:100%;padding:15px;background:rgba(231,76,60,0.1);color:#E74C3C;border:1.5px solid rgba(231,76,60,0.2);border-radius:16px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;margin-top:8px;transition:.2s;}
.btn-danger:hover{background:rgba(231,76,60,0.18);}

/* INPUTS */
.inp{width:100%;padding:15px 17px;background:#161616;border:1.5px solid #252525;border-radius:14px;font-family:'Nunito',sans-serif;font-size:14px;color:#fff;outline:none;transition:.2s;margin-bottom:12px;}
.inp:focus{border-color:var(--o);box-shadow:0 0 0 3px rgba(255,87,34,0.1);}
.inp::placeholder{color:#333;}
.inp-label{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin-bottom:7px;}
.ld{display:inline-block;width:15px;height:15px;border:2px solid rgba(255,255,255,0.25);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:6px;}

/* ALERT */
.alert{padding:11px 14px;border-radius:12px;font-size:13px;font-weight:600;margin-bottom:12px;display:none;}
.alert.err{background:rgba(231,76,60,0.12);color:#E74C3C;border:1px solid rgba(231,76,60,0.25);display:block;}
.alert.ok{background:rgba(39,174,96,0.12);color:#27AE60;border:1px solid rgba(39,174,96,0.25);display:block;}

/* SPACER */
.sp{flex:1;}

/* ‚ïê‚ïê SPLASH ‚ïê‚ïê */
.splash{position:relative;overflow:hidden;}
.splash-bg{position:absolute;inset:0;background-image:url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80');background-size:cover;background-position:center;filter:brightness(0.3);}
.splash-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(15,15,15,0.1) 0%,rgba(15,15,15,0.97) 65%);}
.splash-content{position:relative;z-index:2;flex:1;display:flex;flex-direction:column;justify-content:flex-end;padding:0 26px 50px;}
.splash-badge{display:inline-flex;align-items:center;gap:7px;background:rgba(255,87,34,0.15);border:1px solid rgba(255,87,34,0.35);border-radius:50px;padding:6px 14px;font-size:11px;color:var(--o3);font-weight:800;letter-spacing:.8px;text-transform:uppercase;margin-bottom:18px;width:fit-content;}
.splash-title{font-family:'Syne',sans-serif;font-size:50px;font-weight:900;color:#fff;line-height:1;margin-bottom:12px;letter-spacing:-1.5px;}
.splash-title span{color:var(--o);}
.splash-sub{color:rgba(255,255,255,0.5);font-size:14px;line-height:1.7;margin-bottom:32px;}

/* ‚ïê‚ïê AUTH ‚ïê‚ïê */
.auth-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.auth-hero{height:200px;position:relative;flex-shrink:0;overflow:hidden;}
.auth-hero-img{position:absolute;inset:0;background-image:url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80');background-size:cover;background-position:center top;filter:brightness(0.35);}
.auth-hero-grad{position:absolute;inset:0;background:linear-gradient(180deg,transparent 20%,#0F0F0F 100%);}
.auth-hero-txt{position:absolute;bottom:20px;left:22px;z-index:2;}
.auth-hero-title{font-family:'Syne',sans-serif;font-size:26px;font-weight:900;color:#fff;}
.auth-hero-sub{font-size:12px;color:rgba(255,255,255,0.45);margin-top:3px;}
.auth-body{flex:1;padding:22px;overflow-y:auto;display:flex;flex-direction:column;}
.auth-body::-webkit-scrollbar{display:none;}
.tog-lnk{text-align:center;font-size:13px;color:var(--muted);margin-top:14px;}
.tog-lnk span{color:var(--o);cursor:pointer;font-weight:800;}

/* ‚ïê‚ïê ONBOARDING ‚ïê‚ïê */
.ob-hdr{padding:18px 20px 0;display:flex;align-items:center;gap:12px;flex-shrink:0;}
.back{width:36px;height:36px;border-radius:50%;background:#1A1A1A;border:1px solid #252525;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;flex-shrink:0;transition:.2s;}
.back:hover{background:#222;}
.pdots{display:flex;gap:5px;flex:1;justify-content:flex-end;}
.pd{height:3px;border-radius:2px;background:#222;transition:.4s;flex:1;}
.pd.a{background:var(--o);}
.pd.d{background:rgba(255,87,34,0.3);}
.ob-body{flex:1;padding:22px 22px 18px;display:flex;flex-direction:column;overflow-y:auto;}
.ob-body::-webkit-scrollbar{display:none;}
.ob-tag{font-size:11px;font-weight:800;color:var(--o);text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px;}
.ob-t{font-family:'Syne',sans-serif;font-size:24px;font-weight:900;color:#fff;line-height:1.15;margin-bottom:7px;}
.ob-s{color:var(--muted);font-size:13px;margin-bottom:20px;line-height:1.6;}
.sel-c{width:100%;padding:14px 16px;background:#161616;border:1.5px solid #252525;border-radius:15px;cursor:pointer;display:flex;align-items:center;gap:12px;margin-bottom:9px;transition:.2s;text-align:left;}
.sel-c:hover,.sel-c.on{border-color:var(--o);background:rgba(255,87,34,0.07);}
.sel-c.on{box-shadow:0 0 0 3px rgba(255,87,34,0.08);}
.av{width:40px;height:40px;border-radius:50%;background:#1E1E1E;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.gav{width:44px;height:44px;border-radius:12px;background:#1E1E1E;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.cl{font-weight:700;font-size:14px;color:#fff;}
.cd{font-size:11px;color:var(--muted);margin-top:2px;}
.chk{width:20px;height:20px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--o2));color:#fff;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0;margin-left:auto;}
.src-i{display:flex;align-items:center;gap:12px;padding:12px 2px;border-bottom:1px solid #1A1A1A;cursor:pointer;transition:.15s;}
.src-i:hover{opacity:.7;}
.src-i.on .src-lbl{color:var(--o);font-weight:700;}
.src-lbl{font-size:14px;color:var(--text);flex:1;}
.feat-screen{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.feat-img-w{height:52%;position:relative;flex-shrink:0;overflow:hidden;}
.feat-img-w img{width:100%;height:100%;object-fit:cover;}
.feat-img-grad{position:absolute;inset:0;background:linear-gradient(180deg,transparent 30%,#0F0F0F 100%);}
.feat-bot{padding:4px 24px 26px;flex:1;display:flex;flex-direction:column;}
.fdots{display:flex;gap:6px;margin-bottom:16px;margin-top:14px;}
.fdot{width:6px;height:6px;border-radius:50%;background:#252525;}
.fdot.a{background:var(--o);width:18px;border-radius:3px;}
.feat-t{font-family:'Syne',sans-serif;font-size:24px;font-weight:900;color:#fff;line-height:1.15;margin-bottom:10px;}
.feat-s{color:rgba(255,255,255,0.45);font-size:13px;line-height:1.7;padding-bottom:20px;}
.w-big{font-family:'Syne',sans-serif;font-size:76px;font-weight:900;color:#fff;text-align:center;line-height:1;}
.utog{display:flex;background:#161616;border-radius:11px;padding:3px;width:fit-content;margin:0 auto 16px;border:1px solid #252525;}
.ub{padding:6px 20px;border-radius:9px;border:none;background:transparent;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;cursor:pointer;color:var(--muted);transition:.2s;}
.ub.a{background:var(--o);color:#fff;}
.wsl{width:100%;margin:16px 0 5px;accent-color:var(--o);}
.suc{position:relative;overflow:hidden;flex:1;}
.suc-bg{position:absolute;inset:0;background-image:url('https://images.unsplash.com/photo-1538805060514-97d9cc17730c?w=800&q=80');background-size:cover;background-position:center;filter:brightness(0.2);}
.suc-grad{position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,87,34,0.25) 0%,rgba(15,15,15,0.98) 100%);}
.suc-content{position:relative;z-index:2;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:36px 26px;text-align:center;gap:14px;}
.suc-ring{width:96px;height:96px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--o2));display:flex;align-items:center;justify-content:center;font-size:44px;animation:pop .6s cubic-bezier(.34,1.56,.64,1) .2s both;box-shadow:0 20px 50px rgba(255,87,34,0.5);}
.suc-title{font-family:'Syne',sans-serif;font-size:32px;font-weight:900;color:#fff;}
.suc-sub{color:rgba(255,255,255,0.5);font-size:13px;line-height:1.6;max-width:260px;}
.suc-bub{background:rgba(255,255,255,0.07);backdrop-filter:blur(20px);border-radius:18px;padding:15px 20px;font-size:13px;line-height:1.6;color:rgba(255,255,255,0.8);max-width:280px;border:1px solid rgba(255,255,255,0.1);}

/* ‚ïê‚ïê MAIN APP ‚ïê‚ïê */
.app-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.page{flex:1;overflow-y:auto;padding-bottom:82px;}
.page::-webkit-scrollbar{display:none;}
.bot-nav{position:absolute;bottom:0;left:0;right:0;height:76px;background:rgba(10,10,10,0.97);backdrop-filter:blur(20px);border-top:1px solid #1A1A1A;display:flex;align-items:center;justify-content:space-around;padding:0 4px 8px;z-index:100;}
.nb{display:flex;flex-direction:column;align-items:center;gap:4px;background:none;border:none;cursor:pointer;padding:7px 12px;border-radius:14px;transition:.2s;flex:1;}
.nb .ni{font-size:20px;filter:grayscale(1) opacity(.35);transition:.2s;}
.nb .nl{font-size:10px;font-weight:700;color:#333;transition:.2s;letter-spacing:.2px;}
.nb.on .ni{filter:none;}
.nb.on .nl{color:var(--o);}

/* HOME */
.home-hero{position:relative;height:230px;overflow:hidden;flex-shrink:0;}
.home-hero img{width:100%;height:100%;object-fit:cover;object-position:center 30%;}
.home-hero-grad{position:absolute;inset:0;background:linear-gradient(180deg,rgba(15,15,15,0.55) 0%,#0F0F0F 100%);}
.home-hero-cnt{position:absolute;inset:0;padding:26px 20px 20px;display:flex;flex-direction:column;justify-content:space-between;}
.home-greet{font-size:12px;color:rgba(255,255,255,0.55);font-weight:600;}
.home-name{font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:#fff;}
.notif{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;}

/* CALORIE CARD */
.cal-card{margin:0 14px;margin-top:-55px;position:relative;z-index:10;background:#161616;border-radius:22px;padding:18px;border:1px solid #222;box-shadow:0 20px 50px rgba(0,0,0,0.6);animation:fUp .4s ease;}
.cal-row{display:flex;align-items:center;gap:18px;}
.ring-wrap{position:relative;flex-shrink:0;}
.ring-wrap svg{transform:rotate(-90deg);}
.ring-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.ring-pct{font-family:'Syne',sans-serif;font-size:18px;font-weight:900;color:#fff;}
.ring-lbl{font-size:8px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.3px;}
.cal-info{flex:1;}
.cal-num{font-family:'Syne',sans-serif;font-size:30px;font-weight:900;color:#fff;line-height:1;}
.cal-desc{font-size:11px;color:var(--muted);margin-top:2px;}
.cal-rem{font-size:13px;color:var(--o);font-weight:700;margin-top:6px;}
.cal-goal-lbl{font-size:10px;color:#333;margin-top:2px;font-weight:600;}
.mac-row{display:flex;gap:7px;margin-top:14px;}
.mac-pill{flex:1;background:#111;border-radius:11px;padding:9px 9px 7px;border:1px solid #1C1C1C;}
.mac-n{font-size:9px;color:var(--muted);font-weight:800;text-transform:uppercase;letter-spacing:.3px;margin-bottom:5px;}
.mac-bg{height:3px;border-radius:2px;background:#222;}
.mac-fill{height:3px;border-radius:2px;transition:width .8s ease;}
.mac-v{font-size:12px;font-weight:800;color:#fff;margin-top:4px;}

/* STREAK BANNER */
.streak-banner{margin:12px 14px 0;background:linear-gradient(135deg,rgba(255,87,34,0.12),rgba(255,112,67,0.06));border:1px solid rgba(255,87,34,0.2);border-radius:18px;padding:14px 16px;display:flex;align-items:center;gap:12px;}
.streak-num{font-family:'Syne',sans-serif;font-size:28px;font-weight:900;color:var(--o);}
.streak-info{flex:1;}
.streak-title{font-size:13px;font-weight:800;color:#fff;}
.streak-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.badges-row{display:flex;gap:8px;margin-top:10px;overflow-x:auto;padding-bottom:2px;}
.badges-row::-webkit-scrollbar{display:none;}
.badge-chip{display:flex;align-items:center;gap:5px;background:#161616;border:1px solid #252525;border-radius:50px;padding:5px 11px;white-space:nowrap;flex-shrink:0;}
.badge-chip.earned{border-color:rgba(255,87,34,0.3);background:rgba(255,87,34,0.08);}
.badge-chip span{font-size:14px;}
.badge-chip .badge-lbl{font-size:10px;font-weight:700;color:var(--muted);}
.badge-chip.earned .badge-lbl{color:var(--o3);}

/* SECTION */
.sec-hdr{display:flex;align-items:center;justify-content:space-between;padding:18px 16px 10px;}
.sec-title{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:#fff;}
.sec-action{font-size:12px;font-weight:700;color:var(--o);cursor:pointer;}

/* WATER */
.water-card{margin:0 14px 4px;background:#0C1B2A;border-radius:18px;padding:14px 16px;border:1px solid #0F2233;}
.water-title{font-size:12px;font-weight:800;color:#4FC3F7;margin-bottom:10px;}
.glasses{display:flex;gap:6px;flex-wrap:wrap;}
.glass{width:32px;height:32px;border-radius:9px;background:#0F2030;border:1.5px solid #152A40;display:flex;align-items:center;justify-content:center;font-size:15px;cursor:pointer;transition:.2s;filter:grayscale(1) opacity(.3);}
.glass.on{filter:none;background:#0D2A3D;border-color:#4FC3F7;box-shadow:0 0 10px rgba(79,195,247,0.15);}
.glass:hover{transform:scale(1.12);}
.water-sub{font-size:10px;color:#2A6B8C;margin-top:7px;font-weight:700;}

/* MEALS */
.meal-sec{margin:0 14px 10px;}
.mt-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px;}
.mt-name{font-size:13px;font-weight:700;color:#fff;}
.mt-cal{font-size:11px;color:var(--o);font-weight:700;}
.add-mb{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--o2));border:none;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(255,87,34,0.3);}
.meal-it{display:flex;align-items:center;gap:9px;padding:11px 13px;background:#131313;border-radius:13px;margin-bottom:5px;border:1px solid #1C1C1C;}
.mi-ico{width:34px;height:34px;border-radius:10px;background:#1C1C1C;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
.mi-name{flex:1;font-size:13px;color:#fff;font-weight:600;}
.mi-cal{font-size:12px;color:var(--o);font-weight:700;}
.mi-del{width:20px;height:20px;border-radius:50%;background:transparent;border:none;cursor:pointer;color:#2A2A2A;font-size:13px;display:flex;align-items:center;justify-content:center;transition:.15s;}
.mi-del:hover{color:#E74C3C;background:rgba(231,76,60,0.1);}
.empty-m{padding:14px;background:#111;border-radius:13px;font-size:12px;color:#2A2A2A;text-align:center;border:1.5px dashed #1E1E1E;cursor:pointer;font-weight:700;transition:.2s;}
.empty-m:hover{border-color:var(--o);color:var(--o);}

/* ‚ïê‚ïê LOG PAGE ‚ïê‚ïê */
.log-hdr{padding:22px 18px 14px;flex-shrink:0;}
.log-title{font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:#fff;margin-bottom:12px;}
.mt-tabs{display:flex;gap:6px;overflow-x:auto;}
.mt-tabs::-webkit-scrollbar{display:none;}
.mtab{padding:8px 15px;border-radius:50px;border:1.5px solid #252525;background:#141414;font-family:'Nunito',sans-serif;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;transition:.2s;color:var(--muted);}
.mtab.a{background:linear-gradient(135deg,var(--o),var(--o2));border-color:transparent;color:#fff;box-shadow:0 4px 14px rgba(255,87,34,0.3);}
.srch-w{padding:8px 16px 12px;position:relative;flex-shrink:0;}
.srch{width:100%;padding:12px 14px 12px 40px;background:#141414;border:1.5px solid #1E1E1E;border-radius:13px;font-family:'Nunito',sans-serif;font-size:13px;color:#fff;outline:none;transition:.2s;}
.srch:focus{border-color:var(--o);}
.srch::placeholder{color:#2A2A2A;}
.si{position:absolute;left:29px;top:50%;transform:translateY(-50%);font-size:15px;color:#2A2A2A;}

/* AI Camera */
.cam-btn{margin:0 16px 12px;background:linear-gradient(135deg,rgba(255,87,34,0.15),rgba(255,112,67,0.08));border:1.5px dashed rgba(255,87,34,0.35);border-radius:16px;padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:.2s;}
.cam-btn:hover{background:rgba(255,87,34,0.12);}
.cam-icon{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--o),var(--o2));display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.cam-text{flex:1;}
.cam-title{font-size:14px;font-weight:800;color:#fff;}
.cam-sub{font-size:11px;color:var(--muted);margin-top:2px;}

/* FOOD LIST */
.food-list{flex:1;overflow-y:auto;padding:0 12px;}
.food-list::-webkit-scrollbar{display:none;}
.cat-t{font-size:10px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.7px;padding:8px 4px 5px;}
.fi{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:13px;cursor:pointer;transition:.2s;margin-bottom:5px;border:1.5px solid transparent;background:#111;}
.fi:hover{background:#161616;border-color:#252525;}
.fe{width:40px;height:40px;border-radius:11px;overflow:hidden;flex-shrink:0;background:#1A1A1A;display:flex;align-items:center;justify-content:center;font-size:20px;}
.fe img{width:100%;height:100%;object-fit:cover;}
.fn{flex:1;font-size:13px;font-weight:600;color:#fff;}
.fsub{font-size:10px;color:var(--muted);margin-top:1px;}
.fcal{font-size:13px;font-weight:800;color:var(--o);}
.fa-btn{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--o2));border:none;color:#fff;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.15s;}
.fa-btn:hover{transform:scale(1.1);}
.added-b{width:26px;height:26px;border-radius:50%;background:rgba(39,174,96,0.12);border:1.5px solid #27AE60;display:flex;align-items:center;justify-content:center;font-size:12px;color:#27AE60;flex-shrink:0;}
.cust-w{margin:8px 0 16px;background:#131313;border-radius:15px;padding:15px;border:1px solid #1C1C1C;}
.cust-t{font-size:12px;font-weight:800;color:#fff;margin-bottom:10px;}
.cust-row{display:grid;grid-template-columns:1fr 75px;gap:7px;}
.cust-row .inp{margin-bottom:0;}

/* ‚ïê‚ïê WORKOUT PAGE ‚ïê‚ïê */
.workout-hdr{padding:22px 18px 14px;flex-shrink:0;}
.workout-title{font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:#fff;margin-bottom:4px;}
.workout-sub{font-size:12px;color:var(--muted);}
.today-workout{margin:0 14px 14px;background:#161616;border-radius:18px;padding:16px;border:1px solid #222;}
.tw-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.tw-title{font-size:14px;font-weight:800;color:#fff;}
.tw-date{font-size:11px;color:var(--muted);}
.wo-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:#111;border-radius:12px;margin-bottom:6px;border:1px solid #1C1C1C;}
.wo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,rgba(255,87,34,0.2),rgba(255,112,67,0.1));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.wo-name{flex:1;font-size:13px;font-weight:600;color:#fff;}
.wo-detail{font-size:11px;color:var(--muted);margin-top:2px;}
.wo-cal{font-size:11px;color:var(--o);font-weight:700;}
.wo-del{width:18px;height:18px;border-radius:50%;background:transparent;border:none;cursor:pointer;color:#2A2A2A;font-size:12px;display:flex;align-items:center;justify-content:center;transition:.15s;}
.wo-del:hover{color:#E74C3C;}
.ex-cats{display:flex;gap:6px;overflow-x:auto;padding:0 14px 0;margin-bottom:8px;}
.ex-cats::-webkit-scrollbar{display:none;}
.ex-cat{padding:7px 14px;border-radius:50px;border:1.5px solid #252525;background:#141414;font-family:'Nunito',sans-serif;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;color:var(--muted);transition:.2s;flex-shrink:0;}
.ex-cat.a{background:linear-gradient(135deg,var(--o),var(--o2));border-color:transparent;color:#fff;}
.ex-list{padding:0 14px;}
.ex-item{display:flex;align-items:center;gap:10px;padding:12px 13px;background:#111;border-radius:13px;margin-bottom:7px;border:1px solid #1C1C1C;cursor:pointer;transition:.2s;}
.ex-item:hover{border-color:var(--o);background:#161616;}
.ex-ico{width:40px;height:40px;border-radius:11px;background:linear-gradient(135deg,rgba(255,87,34,0.15),rgba(255,112,67,0.08));display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.ex-name{flex:1;font-size:13px;font-weight:700;color:#fff;}
.ex-muscle{font-size:10px;color:var(--muted);margin-top:2px;}
.ex-cal-lbl{font-size:11px;color:var(--o);font-weight:700;}

/* ‚ïê‚ïê PROGRESS PAGE ‚ïê‚ïê */
.prog-hdr{padding:24px 18px 14px;}
.prog-title{font-family:'Syne',sans-serif;font-size:22px;font-weight:900;color:#fff;margin-bottom:3px;}
.prog-sub{font-size:12px;color:var(--muted);}
.prog-card{background:#161616;border:1px solid #1E1E1E;border-radius:18px;padding:16px;margin:0 14px 12px;}
.prog-card-title{font-size:10px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;}
.bars{display:flex;align-items:flex-end;gap:5px;height:75px;}
.bc{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;}
.bf{width:100%;border-radius:5px 5px 0 0;min-height:3px;transition:height .9s cubic-bezier(.22,1,.36,1);}
.bd-lbl{font-size:9px;color:var(--muted);font-weight:700;}
.bv{font-size:8px;color:var(--o);font-weight:700;}
.str-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px;margin:0 14px 12px;}
.str-c{background:#161616;border:1px solid #1E1E1E;border-radius:15px;padding:13px;text-align:center;}
.str-n{font-family:'Syne',sans-serif;font-size:26px;font-weight:900;color:var(--o);}
.str-l{font-size:10px;color:var(--muted);margin-top:2px;font-weight:700;}
.gp-bar{height:7px;background:#1A1A1A;border-radius:4px;overflow:hidden;margin:9px 0 5px;}
.gp-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--o),var(--o2));transition:width .9s ease;}
.weight-inputs{display:flex;gap:8px;margin-bottom:12px;}
.weight-inputs .inp{margin-bottom:0;flex:1;}

/* ‚ïê‚ïê PROFILE PAGE ‚ïê‚ïê */
.prof-hero{height:190px;position:relative;overflow:hidden;flex-shrink:0;}
.prof-hero img{width:100%;height:100%;object-fit:cover;object-position:center 20%;filter:brightness(0.3);}
.prof-hero-grad{position:absolute;inset:0;background:linear-gradient(180deg,transparent 10%,#0F0F0F 100%);}
.prof-hero-cnt{position:absolute;bottom:18px;left:0;right:0;z-index:2;text-align:center;}
.p-av{width:62px;height:62px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--o2));display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 9px;box-shadow:0 8px 24px rgba(255,87,34,0.4);}
.p-name{font-family:'Syne',sans-serif;font-size:19px;font-weight:900;color:#fff;}
.p-email{font-size:11px;color:rgba(255,255,255,0.35);margin-top:3px;}
.prof-body{padding:16px 14px;overflow-y:auto;flex:1;}
.prof-body::-webkit-scrollbar{display:none;}
.psec{background:#161616;border:1px solid #1E1E1E;border-radius:17px;overflow:hidden;margin-bottom:12px;}
.pr{display:flex;align-items:center;gap:11px;padding:14px 15px;border-bottom:1px solid #1A1A1A;cursor:pointer;transition:.15s;}
.pr:last-child{border-bottom:none;}
.pr:hover{background:#1A1A1A;}
.p-ico{font-size:19px;width:34px;height:34px;border-radius:11px;background:#111;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.p-lbl{font-size:13px;font-weight:600;color:#fff;}
.p-val{font-size:11px;color:var(--muted);margin-top:1px;}
.p-arrow{font-size:14px;color:#2A2A2A;margin-left:auto;}

/* ‚ïê‚ïê MODAL / SHEET ‚ïê‚ïê */
.modal-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.7);z-index:200;display:flex;align-items:flex-end;animation:fadeIn .2s ease;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-sheet{background:#161616;border-radius:26px 26px 0 0;padding:10px 22px 36px;width:100%;animation:slideUp .32s cubic-bezier(.22,1,.36,1);border-top:1px solid #252525;max-height:85%;}
.modal-handle{width:36px;height:3px;border-radius:2px;background:#333;margin:10px auto 18px;}
.modal-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:900;color:#fff;margin-bottom:18px;}
.modal-scroll{overflow-y:auto;max-height:400px;}
.modal-scroll::-webkit-scrollbar{display:none;}

/* CAMERA MODAL */
.cam-modal{background:#161616;border-radius:26px 26px 0 0;padding:10px 22px 36px;width:100%;animation:slideUp .32s cubic-bezier(.22,1,.36,1);border-top:1px solid #252525;}
.cam-preview{width:100%;height:200px;border-radius:16px;background:#111;border:2px dashed #252525;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-bottom:14px;overflow:hidden;position:relative;cursor:pointer;}
.cam-preview img{width:100%;height:100%;object-fit:cover;border-radius:14px;}
.cam-result{background:#111;border-radius:14px;padding:14px;margin-bottom:14px;border:1px solid #252525;}
.cam-result-title{font-size:12px;color:var(--muted);font-weight:700;margin-bottom:8px;}
.cam-result-food{font-size:15px;font-weight:800;color:#fff;margin-bottom:4px;}
.cam-result-cal{font-size:13px;color:var(--o);font-weight:700;}

/* TOAST */
.toast{position:absolute;bottom:94px;left:50%;transform:translateX(-50%) translateY(12px);background:#fff;color:#111;padding:10px 20px;border-radius:50px;font-size:13px;font-weight:700;white-space:nowrap;z-index:999;opacity:0;transition:.3s;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

@media(max-width:430px){body{padding:0;}.phone{width:100vw;height:100vh;border-radius:0;}}
</style>
</head>
<body>
<div class="phone" id="app"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SB_URL='https://ykbqdkxmlwvdwghznvxo.supabase.co';
const SB_KEY='sb_publishable_YtT23xvoxOcqMXt6qJ69vg_kS_fpsLO';
const sb=supabase.createClient(SB_URL,SB_KEY);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S={
  user:null,profile:null,
  authMode:'signup',authErr:'',
  step:0,name:'',gender:'',source:'',goal:'',weight:70,unit:'kg',
  tab:'home',
  meals:{breakfast:[],lunch:[],dinner:[],snacks:[]},
  workouts:[],
  weightHistory:[],
  water:0,streak:0,
  mealType:'breakfast',foodQ:'',added:new Set(),
  exCat:'Strength',
  cal:0,prot:0,carb:0,fat:0,
  modal:null,
  camFile:null,camResult:null,camLoading:false,
};

const OB=['splash','signup','feat1','feat2','name','gender','source','goal','weight','done'];
const PS=['name','gender','source','goal','weight'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOOD DATABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FOODS={
  'ü•û Breakfast':[
    {e:'ü•£',img:'https://images.unsplash.com/photo-1517673132405-a56a62b18caf?w=80&q=70',n:'Oatmeal',cal:150,p:5,c:27,f:3},
    {e:'ü•ö',img:'https://images.unsplash.com/photo-1525351484163-7529414344d8?w=80&q=70',n:'Scrambled Eggs',cal:180,p:13,c:2,f:13},
    {e:'üçå',img:'https://images.unsplash.com/photo-1587132137056-bfbf0166836e?w=80&q=70',n:'Banana',cal:89,p:1,c:23,f:0},
    {e:'ü•û',img:'https://images.unsplash.com/photo-1506084868230-bb9d95c24759?w=80&q=70',n:'Pancakes (2)',cal:220,p:6,c:38,f:5},
    {e:'ü´ê',img:'https://images.unsplash.com/photo-1498557850523-fd3d118b962e?w=80&q=70',n:'Greek Yogurt',cal:100,p:17,c:6,f:0},
    {e:'üçû',img:'https://images.unsplash.com/photo-1588168333986-5078d3ae3976?w=80&q=70',n:'Toast & Butter',cal:130,p:3,c:18,f:5},
  ],
  'ü•ó Lunch':[
    {e:'ü•ó',img:'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=80&q=70',n:'Caesar Salad',cal:280,p:8,c:12,f:22},
    {e:'üçó',img:'https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=80&q=70',n:'Grilled Chicken',cal:165,p:31,c:0,f:4},
    {e:'ü•ô',img:'https://images.unsplash.com/photo-1626700051175-6818013e1d4f?w=80&q=70',n:'Chicken Wrap',cal:350,p:25,c:35,f:10},
    {e:'üç±',img:'https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=80&q=70',n:'Brown Rice Bowl',cal:300,p:8,c:60,f:3},
    {e:'ü•™',img:'https://images.unsplash.com/photo-1553909489-cd47e0907980?w=80&q=70',n:'Turkey Sandwich',cal:320,p:20,c:38,f:8},
  ],
  'üçΩ Dinner':[
    {e:'üêü',img:'https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=80&q=70',n:'Grilled Salmon',cal:280,p:39,c:0,f:13},
    {e:'üçù',img:'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?w=80&q=70',n:'Pasta Bolognese',cal:450,p:22,c:58,f:14},
    {e:'üçó',img:'https://images.unsplash.com/photo-1598103442097-8b74394b95c3?w=80&q=70',n:'Roast Chicken',cal:335,p:38,c:0,f:19},
    {e:'ü•¶',img:'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=80&q=70',n:'Veggie Stir Fry',cal:120,p:4,c:18,f:4},
    {e:'üçö',img:'https://images.unsplash.com/photo-1516684732162-798a0062be99?w=80&q=70',n:'White Rice (1 cup)',cal:200,p:4,c:45,f:0},
  ],
  'üçé Snacks':[
    {e:'üçé',img:'https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?w=80&q=70',n:'Apple',cal:95,p:0,c:25,f:0},
    {e:'ü•ú',img:'https://images.unsplash.com/photo-1559703248-dcaaec9fab78?w=80&q=70',n:'Mixed Nuts (30g)',cal:185,p:5,c:7,f:16},
    {e:'üç´',img:'https://images.unsplash.com/photo-1606312619070-d48b4c652a52?w=80&q=70',n:'Dark Chocolate',cal:170,p:2,c:17,f:10},
    {e:'üçá',img:'https://images.unsplash.com/photo-1537640538966-79f369143f8f?w=80&q=70',n:'Grapes (100g)',cal:67,p:1,c:17,f:0},
    {e:'ü•ï',img:'https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?w=80&q=70',n:'Carrots & Hummus',cal:100,p:4,c:14,f:4},
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXERCISE DATABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const EXERCISES={
  'Strength':[
    {e:'üèãÔ∏è',n:'Bench Press',muscle:'Chest',cal:8},
    {e:'ü¶µ',n:'Squats',muscle:'Legs',cal:10},
    {e:'üí™',n:'Deadlift',muscle:'Back & Legs',cal:11},
    {e:'üîù',n:'Overhead Press',muscle:'Shoulders',cal:7},
    {e:'ü§∏',n:'Pull Ups',muscle:'Back & Biceps',cal:9},
    {e:'üí™',n:'Bicep Curls',muscle:'Biceps',cal:5},
    {e:'üèãÔ∏è',n:'Tricep Dips',muscle:'Triceps',cal:6},
    {e:'ü¶µ',n:'Lunges',muscle:'Legs & Glutes',cal:7},
  ],
  'Cardio':[
    {e:'üèÉ',n:'Running (5km)',muscle:'Full Body',cal:300},
    {e:'üö¥',n:'Cycling (30min)',muscle:'Legs',cal:250},
    {e:'ü§∏',n:'Jump Rope (15min)',muscle:'Full Body',cal:180},
    {e:'üèä',n:'Swimming (30min)',muscle:'Full Body',cal:220},
    {e:'üö∂',n:'Brisk Walk (1hr)',muscle:'Full Body',cal:200},
    {e:'‚õπÔ∏è',n:'HIIT (20min)',muscle:'Full Body',cal:250},
  ],
  'Flexibility':[
    {e:'üßò',n:'Yoga (30min)',muscle:'Full Body',cal:90},
    {e:'ü§∏',n:'Full Body Stretch',muscle:'Full Body',cal:50},
    {e:'üßò',n:'Pilates (30min)',muscle:'Core',cal:120},
    {e:'üíÜ',n:'Foam Rolling',muscle:'Recovery',cal:30},
  ],
  'Core':[
    {e:'üî•',n:'Plank (3 sets)',muscle:'Core',cal:50},
    {e:'üí™',n:'Crunches (3x20)',muscle:'Abs',cal:40},
    {e:'üèãÔ∏è',n:'Russian Twists',muscle:'Obliques',cal:45},
    {e:'ü¶µ',n:'Leg Raises',muscle:'Lower Abs',cal:40},
    {e:'üî•',n:'Mountain Climbers',muscle:'Core & Cardio',cal:60},
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BADGES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getBadges(){
  const b=[];
  const totalMeals=Object.values(S.meals).flat().length;
  if(totalMeals>=1)b.push({e:'üçΩ',l:'First Meal',earned:true});
  if(S.water>=8)b.push({e:'üíß',l:'Hydrated',earned:true});
  if(S.streak>=3)b.push({e:'üî•',l:'3 Day Streak',earned:true});
  if(S.streak>=7)b.push({e:'‚ö°',l:'Week Streak',earned:true});
  if(S.workouts.length>=1)b.push({e:'üèãÔ∏è',l:'First Workout',earned:true});
  if(totalMeals<1)b.push({e:'üçΩ',l:'First Meal',earned:false});
  if(S.water<8)b.push({e:'üíß',l:'Hydrated',earned:false});
  if(S.streak<3)b.push({e:'üî•',l:'3 Day Streak',earned:false});
  if(S.workouts.length<1)b.push({e:'üèãÔ∏è',l:'First Workout',earned:false});
  return b.slice(0,6);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALC GOAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcGoal(p){
  if(!p)return 2000;
  const w=p.unit==='lbs'?p.weight*0.453:p.weight;
  const adj={muscle:300,lose:-500,maintain:0,healthier:0}[p.goal]||0;
  return Math.round(w*28+adj);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(session){S.user=session.user;await loadAll();renderApp();}
  else renderOB();
}
async function loadAll(){await loadProfile();await loadMeals();await loadWater();await loadWorkouts();await loadStreak();}
async function loadProfile(){const{data}=await sb.from('profiles').select('*').eq('id',S.user.id).single();if(data)S.profile=data;}
async function loadMeals(){
  const today=new Date().toISOString().split('T')[0];
  const{data}=await sb.from('meal_logs').select('*').eq('user_id',S.user.id).gte('created_at',today);
  S.meals={breakfast:[],lunch:[],dinner:[],snacks:[]};S.cal=0;S.prot=0;S.carb=0;S.fat=0;
  if(data)data.forEach(m=>{if(S.meals[m.meal_type])S.meals[m.meal_type].push(m);S.cal+=m.calories||0;S.prot+=m.protein||0;S.carb+=m.carbs||0;S.fat+=m.fat||0;});
}
async function loadWater(){
  const today=new Date().toISOString().split('T')[0];
  const{data}=await sb.from('water_logs').select('glasses').eq('user_id',S.user.id).eq('date',today).single().catch(()=>({data:null}));
  S.water=data?.glasses||0;
}
async function loadWorkouts(){
  try{
    const today=new Date().toISOString().split('T')[0];
    const{data}=await sb.from('workout_logs').select('*').eq('user_id',S.user.id).gte('created_at',today);
    S.workouts=data||[];
  }catch(e){S.workouts=[];}
}
async function loadStreak(){
  // Calculate streak from meal_logs - count consecutive days
  const{data}=await sb.from('meal_logs').select('created_at').eq('user_id',S.user.id).order('created_at',{ascending:false}).limit(30).catch(()=>({data:[]}));
  if(!data||!data.length){S.streak=0;return;}
  const days=new Set(data.map(m=>m.created_at.split('T')[0]));
  let streak=0,d=new Date();
  for(let i=0;i<30;i++){
    const ds=d.toISOString().split('T')[0];
    if(days.has(ds)){streak++;d.setDate(d.getDate()-1);}
    else break;
  }
  S.streak=streak;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doSignup(){
  const e=document.getElementById('eI')?.value.trim(),p=document.getElementById('pI')?.value;
  if(!e||!p){setErr('Please enter your email and password.');return;}
  if(p.length<6){setErr('Password needs at least 6 characters.');return;}
  setBL(true);
  const{data,error}=await sb.auth.signUp({email:e,password:p});
  setBL(false);
  if(error){setErr(error.message);return;}
  S.user=data.user;S.step++;renderOB();
}
async function doLogin(){
  const e=document.getElementById('eI')?.value.trim(),p=document.getElementById('pI')?.value;
  if(!e||!p){setErr('Please enter your email and password.');return;}
  setBL(true);
  const{data,error}=await sb.auth.signInWithPassword({email:e,password:p});
  setBL(false);
  if(error){setErr('Invalid email or password. Try again.');return;}
  S.user=data.user;await loadAll();renderApp();
}
function setErr(m){const el=document.getElementById('aA');if(el){el.className='alert err';el.textContent=m;}}
function setBL(v){const b=document.getElementById('aB');if(!b)return;b.disabled=v;b.innerHTML=v?`<span class="ld"></span>Please wait...`:(S.authMode==='signup'?'Create Account':'Log In');}
function toggleAuth(){S.authMode=S.authMode==='signup'?'login':'signup';renderOB();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE SAVE + UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function savePro(){
  const b=document.getElementById('svB');if(b){b.disabled=true;b.innerHTML='<span class="ld"></span>Saving...';}
  const{error}=await sb.from('profiles').upsert({id:S.user.id,name:S.name,gender:S.gender,source:S.source,goal:S.goal,weight:S.weight,unit:S.unit});
  if(error){toast('Error saving. Try again.');if(b){b.disabled=false;b.textContent='Save & Finish';}return;}
  await loadProfile();S.step++;renderOB();
}

async function updateProfile(field,value){
  const update={id:S.user.id,[field]:value};
  const{error}=await sb.from('profiles').upsert(update);
  if(error){toast('Error updating. Try again.');return false;}
  await loadProfile();return true;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGOUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function logout(){
  await sb.auth.signOut();
  Object.assign(S,{user:null,profile:null,step:0,name:'',gender:'',source:'',goal:'',weight:70,unit:'kg',meals:{breakfast:[],lunch:[],dinner:[],snacks:[]},workouts:[],water:0,streak:0,tab:'home',cal:0,prot:0,carb:0,fat:0,modal:null});
  renderOB();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function addFood(f,mt){
  const{data,error}=await sb.from('meal_logs').insert({user_id:S.user.id,food_name:f.n,calories:f.cal,protein:f.p,carbs:f.c,fat:f.f,meal_type:mt}).select().single();
  if(error){toast('Error adding food');return;}
  S.meals[mt].push(data);S.cal+=f.cal;S.prot+=f.p;S.carb+=f.c;S.fat+=f.f;
  S.added.add(f.n+mt);toast(`‚úì ${f.n} added`);
  if(S.tab==='log')renderLogPage();if(S.tab==='home')renderHome();
}
async function delFood(id,mt){
  const m=S.meals[mt]?.find(x=>x.id===id);if(!m)return;
  await sb.from('meal_logs').delete().eq('id',id);
  S.meals[mt]=S.meals[mt].filter(x=>x.id!==id);
  S.cal-=m.calories||0;S.prot-=m.protein||0;S.carb-=m.carbs||0;S.fat-=m.fat||0;
  toast('Removed');renderHome();
}
async function addCustom(){
  const n=document.getElementById('cN')?.value.trim(),c=parseInt(document.getElementById('cC')?.value)||0;
  if(!n||!c){toast('Enter name & calories');return;}
  await addFood({n,cal:c,p:0,c:0,f:0,e:'üçΩ'},S.mealType);
  if(document.getElementById('cN'))document.getElementById('cN').value='';
  if(document.getElementById('cC'))document.getElementById('cC').value='';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WATER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function toggleWater(g){
  const today=new Date().toISOString().split('T')[0];
  S.water=S.water>=g?g-1:g;
  await sb.from('water_logs').upsert({user_id:S.user.id,date:today,glasses:S.water});
  renderHome();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WORKOUTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function logExercise(ex){
  const sets=parseInt(document.getElementById('wo-sets')?.value)||3;
  const reps=parseInt(document.getElementById('wo-reps')?.value)||10;
  const calBurned=ex.cal*sets;
  const{data,error}=await sb.from('workout_logs').insert({
    user_id:S.user.id,exercise_name:ex.n,muscle_group:ex.muscle,
    sets,reps,calories_burned:calBurned,emoji:ex.e
  }).select().single().catch(()=>({data:null,error:'no table'}));
  if(error){
    // Table might not exist yet ‚Äî show instructions
    toast('‚ö†Ô∏è Run workout SQL first! (see below)');closeModal();return;
  }
  if(data)S.workouts.push(data);
  toast(`‚úì ${ex.n} logged! -${calBurned} cal`);
  closeModal();renderWorkout();
}
async function delWorkout(id){
  await sb.from('workout_logs').delete().eq('id',id).catch(()=>{});
  S.workouts=S.workouts.filter(x=>x.id!==id);
  renderWorkout();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI FOOD CAMERA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openCamera(){
  showModal('camera');
}
function handleCamFile(e){
  const file=e.target.files[0];
  if(!file)return;
  S.camFile=file;
  S.camResult=null;
  const reader=new FileReader();
  reader.onload=ev=>{
    const img=document.getElementById('camPreviewImg');
    if(img){img.src=ev.target.result;img.style.display='block';}
    const placeholder=document.getElementById('camPlaceholder');
    if(placeholder)placeholder.style.display='none';
  };
  reader.readAsDataURL(file);
}
async function analyzeFood(){
  if(!S.camFile){toast('Take or upload a photo first');return;}
  S.camLoading=true;
  const analyzeBtn=document.getElementById('analyzeBtn');
  if(analyzeBtn){analyzeBtn.disabled=true;analyzeBtn.innerHTML='<span class="ld"></span>Analyzing...';}

  try{
    const reader=new FileReader();
    reader.onload=async ev=>{
      const base64=ev.target.result.split(',')[1];
      const response=await fetch('https://api.anthropic.com/v1/messages',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          model:'claude-sonnet-4-20250514',
          max_tokens:500,
          messages:[{role:'user',content:[
            {type:'image',source:{type:'base64',media_type:S.camFile.type,data:base64}},
            {type:'text',text:'Identify this food and estimate calories. Reply ONLY in JSON: {"food":"name","calories":number,"protein":number,"carbs":number,"fat":number,"confidence":"high/medium/low"}'}
          ]}]
        })
      });
      const result=await response.json();
      const text=result.content?.[0]?.text||'{}';
      try{
        const clean=text.replace(/```json|```/g,'').trim();
        S.camResult=JSON.parse(clean);
        renderCameraModal();
      }catch{toast('Could not identify food. Try a clearer photo.');}
      S.camLoading=false;
    };
    reader.readAsDataURL(S.camFile);
  }catch(err){
    toast('Analysis failed. Try again.');
    S.camLoading=false;
    if(analyzeBtn){analyzeBtn.disabled=false;analyzeBtn.innerHTML='üîç Analyze Food';}
  }
}
async function logCamFood(){
  if(!S.camResult)return;
  await addFood({n:S.camResult.food,cal:S.camResult.calories,p:S.camResult.protein||0,c:S.camResult.carbs||0,f:S.camResult.fat||0,e:'üì∏'},S.mealType);
  S.camFile=null;S.camResult=null;
  closeModal();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showModal(type,data={}){
  S.modal={type,...data};
  renderModal();
}
function closeModal(){
  S.modal=null;
  const m=document.getElementById('modalWrap');
  if(m)m.remove();
}
function renderModal(){
  const existing=document.getElementById('modalWrap');
  if(existing)existing.remove();
  const wrap=document.createElement('div');
  wrap.id='modalWrap';
  wrap.className='modal-overlay';
  wrap.onclick=e=>{if(e.target===wrap)closeModal();};
  wrap.innerHTML=getModalHTML();
  document.querySelector('.phone').appendChild(wrap);
}
function getModalHTML(){
  const{type}=S.modal||{};

  if(type==='editName') return`<div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Edit Name</div>
    <div class="inp-label">Your Name</div>
    <input class="inp" id="editVal" placeholder="Enter your name" value="${S.profile?.name||''}"/>
    <button class="btn-main" onclick="saveEdit('name')">Save Changes</button>
    <button class="btn-ghost" onclick="closeModal()">Cancel</button>
  </div>`;

  if(type==='editGender') return`<div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Edit Gender</div>
    ${[['male','üë®','Male','He/him'],['female','üë©','Female','She/her'],['other','üßë','Non-binary','They/them']].map(([v,e,l,d])=>`
    <div class="sel-c ${S.profile?.gender===v?'on':''}" onclick="saveEditDirect('gender','${v}')">
      <div class="av">${e}</div><div style="flex:1"><div class="cl">${l}</div><div class="cd">${d}</div></div>
      ${S.profile?.gender===v?`<div class="chk">‚úì</div>`:''}
    </div>`).join('')}
    <button class="btn-ghost" style="margin-top:8px" onclick="closeModal()">Cancel</button>
  </div>`;

  if(type==='editGoal') return`<div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Change Goal</div>
    ${[['muscle','üí™','Build Muscle','Gain strength and muscle'],['healthier','ü•¶','Eat Healthier','Better nutrition habits'],['lose','‚öñÔ∏è','Lose Weight','Sustainable fat loss'],['maintain','üéØ','Maintain Weight','Stay at current weight']].map(([v,e,l,d])=>`
    <div class="sel-c ${S.profile?.goal===v?'on':''}" onclick="saveEditDirect('goal','${v}')">
      <div class="gav">${e}</div><div style="flex:1"><div class="cl">${l}</div><div class="cd">${d}</div></div>
      ${S.profile?.goal===v?`<div class="chk">‚úì</div>`:''}
    </div>`).join('')}
    <button class="btn-ghost" style="margin-top:8px" onclick="closeModal()">Cancel</button>
  </div>`;

  if(type==='editWeight') return`<div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Update Weight</div>
    <div class="utog" style="margin-bottom:16px">
      <button class="ub ${(S.profile?.unit||'kg')==='kg'?'a':''}" onclick="S.profile.unit='kg';renderModal()">kg</button>
      <button class="ub ${(S.profile?.unit||'kg')==='lbs'?'a':''}" onclick="S.profile.unit='lbs';renderModal()">lbs</button>
    </div>
    <div class="inp-label">Current Weight</div>
    <input class="inp" id="editVal" type="number" placeholder="Enter weight" value="${S.profile?.weight||''}"/>
    <button class="btn-main" onclick="saveWeightEdit()">Save Changes</button>
    <button class="btn-ghost" onclick="closeModal()">Cancel</button>
  </div>`;

  if(type==='logWorkout') return`<div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Log ${S.modal.ex.e} ${S.modal.ex.n}</div>
    <div style="background:#111;border-radius:14px;padding:12px 14px;margin-bottom:16px;border:1px solid #1E1E1E">
      <div style="font-size:12px;color:var(--muted);font-weight:700">Muscle Group</div>
      <div style="font-size:14px;font-weight:700;color:#fff;margin-top:3px">${S.modal.ex.muscle}</div>
      <div style="font-size:11px;color:var(--o);margin-top:4px;font-weight:700">~${S.modal.ex.cal} cal/set</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px">
      <div>
        <div class="inp-label">Sets</div>
        <input class="inp" id="wo-sets" type="number" value="3" min="1" max="20" style="margin:0"/>
      </div>
      <div>
        <div class="inp-label">Reps</div>
        <input class="inp" id="wo-reps" type="number" value="10" min="1" max="100" style="margin:0"/>
      </div>
    </div>
    <button class="btn-main" onclick="logExercise(${JSON.stringify(S.modal.ex).replace(/"/g,"'")})">Log Exercise ‚úì</button>
    <button class="btn-ghost" onclick="closeModal()">Cancel</button>
  </div>`;

  if(type==='camera') return`<div class="cam-modal">
    <div class="modal-handle"></div>
    <div class="modal-title">üì∏ AI Food Snap</div>
    <div class="cam-preview" onclick="document.getElementById('camInput').click()">
      <img id="camPreviewImg" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:14px"/>
      <div id="camPlaceholder" style="display:flex;flex-direction:column;align-items:center;gap:8px">
        <div style="font-size:40px">üì∑</div>
        <div style="font-size:13px;color:var(--muted);font-weight:600">Tap to take/upload photo</div>
        <div style="font-size:11px;color:#2A2A2A">AI will identify the food & calories</div>
      </div>
      <input type="file" id="camInput" accept="image/*" capture="environment" style="display:none" onchange="handleCamFile(event)"/>
    </div>
    ${S.camResult?`<div class="cam-result">
      <div class="cam-result-title">ü§ñ AI Identified:</div>
      <div class="cam-result-food">${S.camResult.food}</div>
      <div class="cam-result-cal">~${S.camResult.calories} calories ¬∑ ${S.camResult.protein||0}g protein ¬∑ ${S.camResult.carbs||0}g carbs ¬∑ ${S.camResult.fat||0}g fat</div>
      <div style="font-size:10px;color:var(--muted);margin-top:5px;font-weight:600">Confidence: ${S.camResult.confidence||'medium'}</div>
    </div>
    <button class="btn-main" onclick="logCamFood()">‚úì Add to ${S.mealType}</button>
    <button class="btn-ghost" onclick="S.camResult=null;renderModal()">Try Again</button>`
    :`<button class="btn-main" id="analyzeBtn" onclick="analyzeFood()">üîç Analyze Food</button>`}
    <button class="btn-ghost" onclick="closeModal()">Cancel</button>
  </div>`;

  return'';
}

function renderCameraModal(){
  renderModal();
}

async function saveEdit(field){
  const val=document.getElementById('editVal')?.value.trim();
  if(!val){toast('Please enter a value');return;}
  const ok=await updateProfile(field,val);
  if(ok){toast('‚úì Updated!');closeModal();renderProfile();}
}
async function saveEditDirect(field,val){
  const ok=await updateProfile(field,val);
  if(ok){toast('‚úì Updated!');closeModal();renderProfile();}
}
async function saveWeightEdit(){
  const val=parseFloat(document.getElementById('editVal')?.value);
  if(!val){toast('Enter a valid weight');return;}
  const ok=await updateProfile('weight',val);
  const ok2=await updateProfile('unit',S.profile?.unit||'kg');
  if(ok){
    // Also log to weight history
    const today=new Date().toISOString().split('T')[0];
    await sb.from('weight_history').upsert({user_id:S.user.id,weight:val,unit:S.profile?.unit||'kg',date:today}).catch(()=>{});
    toast('‚úì Weight updated!');closeModal();renderProfile();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg){
  const t=document.getElementById('toastEl');if(!t)return;
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setTab(t){S.tab=t;S.added=new Set();S.modal=null;renderApp();}
function navHTML(){
  const tabs=[{id:'home',i:'üè†',l:'Home'},{id:'log',i:'‚ûï',l:'Log'},{id:'workout',i:'üèãÔ∏è',l:'Workout'},{id:'progress',i:'üìä',l:'Progress'},{id:'profile',i:'üë§',l:'Profile'}];
  return`<div class="bot-nav">${tabs.map(t=>`<button class="nb ${S.tab===t.id?'on':''}" onclick="setTab('${t.id}')"><span class="ni">${t.i}</span><span class="nl">${t.l}</span></button>`).join('')}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER APP SHELL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderApp(){
  document.getElementById('app').innerHTML=`<div id="toastEl" class="toast"></div><div class="app-wrap"><div class="page" id="pg"></div>${navHTML()}</div>`;
  if(S.tab==='home')renderHome();
  else if(S.tab==='log')renderLogPage();
  else if(S.tab==='workout')renderWorkout();
  else if(S.tab==='progress')renderProgress();
  else if(S.tab==='profile')renderProfile();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHome(){
  const goal=calcGoal(S.profile);
  const rem=Math.max(0,goal-S.cal);
  const pct=Math.min(1,S.cal/goal);
  const R=42,C=2*Math.PI*R,dash=C*pct;
  const h=new Date().getHours();
  const greet=h<12?'Good morning ‚òÄÔ∏è':h<17?'Good afternoon üå§':'Good evening üåô';
  const heroImgs=['https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80','https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80'];
  const badges=getBadges();
  const mSec=(type,lbl,em)=>{
    const its=S.meals[type]||[];
    const tot=its.reduce((a,m)=>a+(m.calories||0),0);
    return`<div class="meal-sec"><div class="mt-hdr"><span class="mt-name">${em} ${lbl}</span><div style="display:flex;align-items:center;gap:7px">${tot?`<span class="mt-cal">${tot} kcal</span>`:''}<button class="add-mb" onclick="S.tab='log';S.mealType='${type}';renderApp()">+</button></div></div>${its.length?its.map(m=>`<div class="meal-it"><div class="mi-ico">üçΩ</div><span class="mi-name">${m.food_name}</span><span class="mi-cal">${m.calories}</span><button class="mi-del" onclick="delFood('${m.id}','${type}')">‚úï</button></div>`).join(''):`<div class="empty-m" onclick="S.tab='log';S.mealType='${type}';renderApp()">+ Tap to add ${lbl.toLowerCase()}</div>`}</div>`;
  };
  document.getElementById('pg').innerHTML=`
  <div class="home-hero">
    <img src="${heroImgs[0]}" alt="" loading="lazy"/>
    <div class="home-hero-grad"></div>
    <div class="home-hero-cnt">
      <div><div class="home-greet">${greet}</div><div class="home-name">${S.profile?.name||'there'} üëã</div></div>
      <div class="notif">üîî</div>
    </div>
  </div>

  <div class="cal-card">
    <div class="cal-row">
      <div class="ring-wrap">
        <svg width="96" height="96" viewBox="0 0 96 96">
          <circle cx="48" cy="48" r="${R}" fill="none" stroke="#1E1E1E" stroke-width="8"/>
          <circle cx="48" cy="48" r="${R}" fill="none" stroke="url(#rg)" stroke-width="8"
            stroke-dasharray="${dash} ${C}" stroke-dashoffset="${C/4}" stroke-linecap="round"/>
          <defs><linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#FF5722"/><stop offset="100%" stop-color="#FF7043"/>
          </linearGradient></defs>
        </svg>
        <div class="ring-center"><div class="ring-pct">${Math.round(pct*100)}%</div><div class="ring-lbl">done</div></div>
      </div>
      <div class="cal-info">
        <div class="cal-num">${S.cal}</div>
        <div class="cal-desc">calories consumed</div>
        <div class="cal-rem">${rem} kcal remaining</div>
        <div class="cal-goal-lbl">Goal ¬∑ ${goal} kcal/day</div>
      </div>
    </div>
    <div class="mac-row">
      ${[['Protein',S.prot,50,'g','#FF6B6B'],['Carbs',S.carb,200,'g','#4ECDC4'],['Fat',S.fat,65,'g','#FFE66D']].map(([n,v,mx,u,c])=>`
      <div class="mac-pill"><div class="mac-n">${n}</div>
      <div class="mac-bg"><div class="mac-fill" style="width:${Math.min(100,(v/mx)*100)}%;background:${c}"></div></div>
      <div class="mac-v">${Math.round(v)}${u}</div></div>`).join('')}
    </div>
  </div>

  <div class="streak-banner">
    <div style="font-size:28px">${S.streak>=3?'üî•':'üí´'}</div>
    <div style="flex:1">
      <div class="streak-title">${S.streak} Day Streak ${S.streak===0?'‚Äî Start today!':S.streak<3?'‚Äî Keep going!':'‚Äî You\'re on fire!'}</div>
      <div class="streak-sub">Log your meals daily to build your streak</div>
    </div>
  </div>
  <div class="badges-row" style="padding:8px 14px 0">
    ${badges.map(b=>`<div class="badge-chip ${b.earned?'earned':''}"><span>${b.e}</span><span class="badge-lbl">${b.l}</span></div>`).join('')}
  </div>

  <div class="sec-hdr"><span class="sec-title">üíß Water</span><span class="sec-action">${S.water}/8 glasses</span></div>
  <div class="water-card">
    <div class="glasses">${Array.from({length:8},(_,i)=>`<div class="glass ${i<S.water?'on':''}" onclick="toggleWater(${i+1})">üíß</div>`).join('')}</div>
    <div class="water-sub">${S.water>=8?'üéâ Daily goal reached!':S.water>0?`${8-S.water} more to reach your goal`:'Tap a glass to track water'}</div>
  </div>

  <div class="sec-hdr"><span class="sec-title">üçΩ Today's Meals</span><span class="sec-action" onclick="S.tab='log';renderApp()">+ Add</span></div>
  ${mSec('breakfast','Breakfast','üåÖ')}
  ${mSec('lunch','Lunch','‚òÄÔ∏è')}
  ${mSec('dinner','Dinner','üåô')}
  ${mSec('snacks','Snacks','üçé')}
  <div style="height:8px"></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOG PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderLogPage(){
  const types=['breakfast','lunch','dinner','snacks'];
  const q=S.foodQ.toLowerCase();
  document.getElementById('pg').innerHTML=`
  <div class="log-hdr">
    <div class="log-title">Log Meal</div>
    <div class="mt-tabs">${types.map(t=>`<button class="mtab ${S.mealType===t?'a':''}" onclick="S.mealType='${t}';renderLogPage()">${t[0].toUpperCase()+t.slice(1)}</button>`).join('')}</div>
  </div>
  <div class="srch-w"><span class="si">üîç</span>
    <input class="srch" placeholder="Search foods..." value="${S.foodQ}" oninput="S.foodQ=this.value;renderLogPage()" autocomplete="off"/>
  </div>
  <div class="cam-btn" onclick="openCamera()">
    <div class="cam-icon">üì∏</div>
    <div class="cam-text">
      <div class="cam-title">AI Food Snap</div>
      <div class="cam-sub">Take a photo ‚Äî AI identifies & logs calories</div>
    </div>
    <div style="font-size:18px;color:var(--muted)">‚Ä∫</div>
  </div>
  <div class="food-list">
    ${Object.entries(FOODS).map(([cat,foods])=>{
      const fl=q?foods.filter(f=>f.n.toLowerCase().includes(q)):foods;
      if(!fl.length)return'';
      return`<div class="cat-t">${cat}</div>${fl.map(f=>{
        const k=f.n+S.mealType,added=S.added.has(k);
        return`<div class="fi">
          <div class="fe">${f.img?`<img src="${f.img}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='${f.e}'">`:`${f.e}`}</div>
          <div style="flex:1"><div class="fn">${f.n}</div><div class="fsub">${f.p}g prot ¬∑ ${f.c}g carbs ¬∑ ${f.f}g fat</div></div>
          <div class="fcal">${f.cal}</div>
          ${added?`<div class="added-b">‚úì</div>`:`<button class="fa-btn" onclick="addFood(${JSON.stringify(f).replace(/"/g,"'")},'${S.mealType}')">+</button>`}
        </div>`;
      }).join('')}`;
    }).join('')}
    <div class="cust-w">
      <div class="cust-t">‚úèÔ∏è Custom food</div>
      <div class="cust-row">
        <input class="inp" id="cN" placeholder="Food name" style="margin:0"/>
        <input class="inp" id="cC" placeholder="Cal" type="number" style="margin:0"/>
      </div>
      <button class="btn-main" style="margin-top:10px;padding:13px;font-size:13px" onclick="addCustom()">Add to ${S.mealType}</button>
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WORKOUT PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderWorkout(){
  const today=new Date().toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});
  const totalWoCal=S.workouts.reduce((a,w)=>a+(w.calories_burned||0),0);
  const cats=Object.keys(EXERCISES);
  const exs=EXERCISES[S.exCat]||[];
  document.getElementById('pg').innerHTML=`
  <div class="workout-hdr">
    <div class="workout-title">Workout</div>
    <div class="workout-sub">Track your exercises & calories burned</div>
  </div>

  <div class="today-workout">
    <div class="tw-header">
      <div class="tw-title">Today's Session</div>
      <div style="display:flex;align-items:center;gap:8px">
        ${totalWoCal?`<div style="font-size:12px;color:var(--o);font-weight:700">-${totalWoCal} cal burned</div>`:''}
        <div class="tw-date">${today}</div>
      </div>
    </div>
    ${S.workouts.length?S.workouts.map(w=>`
    <div class="wo-item">
      <div class="wo-icon">${w.emoji||'üèãÔ∏è'}</div>
      <div style="flex:1">
        <div class="wo-name">${w.exercise_name}</div>
        <div class="wo-detail">${w.sets} sets √ó ${w.reps} reps ¬∑ ${w.muscle_group}</div>
      </div>
      <div class="wo-cal">-${w.calories_burned} cal</div>
      <button class="wo-del" onclick="delWorkout('${w.id}')">‚úï</button>
    </div>`).join(''):`
    <div style="text-align:center;padding:20px;color:var(--muted);font-size:13px;font-weight:600">
      <div style="font-size:36px;margin-bottom:8px">üèãÔ∏è</div>
      No workouts yet today<br/>
      <span style="font-size:11px;color:#2A2A2A">Pick an exercise below to get started</span>
    </div>`}
  </div>

  <div class="sec-hdr"><span class="sec-title">Exercise Library</span></div>
  <div class="ex-cats">
    ${cats.map(c=>`<button class="ex-cat ${S.exCat===c?'a':''}" onclick="S.exCat='${c}';renderWorkout()">${c}</button>`).join('')}
  </div>
  <div class="ex-list">
    ${exs.map(ex=>`
    <div class="ex-item" onclick="showModal('logWorkout',{ex:${JSON.stringify(ex).replace(/"/g,"'")}})">
      <div class="ex-ico">${ex.e}</div>
      <div style="flex:1">
        <div class="ex-name">${ex.n}</div>
        <div class="ex-muscle">${ex.muscle}</div>
      </div>
      <div class="ex-cal-lbl">~${ex.cal} cal/set</div>
      <div style="font-size:16px;color:var(--muted);margin-left:8px">+</div>
    </div>`).join('')}
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProgress(){
  const goal=calcGoal(S.profile);
  const pct=Math.min(100,Math.round((S.cal/goal)*100));
  const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const ti=(new Date().getDay()+6)%7;
  const wk=days.map((_,i)=>i===ti?S.cal:Math.round(goal*(0.4+Math.random()*0.7)));
  const mx=Math.max(...wk,goal);
  const totalWoCal=S.workouts.reduce((a,w)=>a+(w.calories_burned||0),0);
  document.getElementById('pg').innerHTML=`
  <div class="prog-hdr"><div class="prog-title">Progress</div><div class="prog-sub">Your stats at a glance</div></div>
  <div class="str-row">
    <div class="str-c"><div class="str-n">${S.streak}</div><div class="str-l">üî• Streak</div></div>
    <div class="str-c"><div class="str-n">${S.water}</div><div class="str-l">üíß Glasses</div></div>
    <div class="str-c"><div class="str-n">${pct}%</div><div class="str-l">üéØ Goal</div></div>
  </div>
  <div class="prog-card">
    <div class="prog-card-title">üìÖ This Week's Calories</div>
    <div class="bars">${wk.map((v,i)=>`<div class="bc">
      <div class="bv">${v}</div>
      <div class="bf" style="height:${Math.round((v/mx)*65)}px;background:${i===ti?'linear-gradient(180deg,#FF5722,#FF7043)':'#252525'}"></div>
      <div class="bd-lbl" style="${i===ti?'color:var(--o)':''}">${days[i]}</div>
    </div>`).join('')}</div>
    <div style="margin-top:10px;font-size:10px;color:#2A2A2A;font-weight:700">Goal: ${goal} kcal/day</div>
  </div>
  <div class="prog-card">
    <div class="prog-card-title">üéØ Today's Goal</div>
    <div style="display:flex;justify-content:space-between;font-size:12px;font-weight:700;margin-bottom:5px"><span style="color:#fff">${S.cal} consumed</span><span style="color:var(--muted)">${goal} goal</span></div>
    <div class="gp-bar"><div class="gp-fill" style="width:${pct}%"></div></div>
    <div style="font-size:11px;color:var(--muted);font-weight:600">${pct}% of daily goal ¬∑ ${rem} remaining</div>
  </div>
  ${totalWoCal?`<div class="prog-card">
    <div class="prog-card-title">üèãÔ∏è Workout Calories Burned</div>
    <div style="font-family:'Syne',sans-serif;font-size:36px;font-weight:900;color:var(--o)">${totalWoCal}</div>
    <div style="font-size:12px;color:var(--muted);margin-top:4px;font-weight:600">calories burned today ¬∑ ${S.workouts.length} exercises</div>
  </div>`:''}
  <div class="prog-card">
    <div class="prog-card-title">üí™ Macros Today</div>
    ${[['Protein',S.prot,50,'g','#FF6B6B'],['Carbs',S.carb,200,'g','#4ECDC4'],['Fat',S.fat,65,'g','#FFE66D']].map(([n,v,mx,u,c])=>`
    <div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:5px;font-weight:700"><span style="color:#fff">${n}</span><span style="color:var(--muted)">${Math.round(v)}${u}/${mx}${u}</span></div>
      <div style="height:6px;background:#1A1A1A;border-radius:3px;overflow:hidden"><div style="height:100%;width:${Math.min(100,(v/mx)*100)}%;background:${c};border-radius:3px;transition:width .9s ease"></div></div>
    </div>`).join('')}
  </div>`;
  // fix rem reference
  const rem2=Math.max(0,calcGoal(S.profile)-S.cal);
  document.getElementById('pg').innerHTML=document.getElementById('pg').innerHTML.replace('${rem}',rem2);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE ‚Äî all rows are now interactive
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfile(){
  const p=S.profile;
  const gl={muscle:'Build Muscle üí™',healthier:'Eat Healthier ü•¶',lose:'Lose Weight ‚öñÔ∏è',maintain:'Maintain Weight üéØ'};
  const ge={male:'Male üë®',female:'Female üë©',other:'Non-binary üßë'};
  document.getElementById('pg').innerHTML=`
  <div class="prof-hero">
    <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80" alt=""/>
    <div class="prof-hero-grad"></div>
    <div class="prof-hero-cnt">
      <div class="p-av">üòä</div>
      <div class="p-name">${p?.name||'Fitness Fan'}</div>
      <div class="p-email">${S.user?.email}</div>
    </div>
  </div>
  <div class="prof-body">
    <div style="font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;padding:0 2px">Tap any row to edit</div>
    <div class="psec">
      <div class="pr" onclick="showModal('editName')">
        <div class="p-ico">‚úèÔ∏è</div>
        <div style="flex:1"><div class="p-lbl">Name</div><div class="p-val">${p?.name||'Not set'}</div></div>
        <div class="p-arrow">‚Ä∫</div>
      </div>
      <div class="pr" onclick="showModal('editGender')">
        <div class="p-ico">üë§</div>
        <div style="flex:1"><div class="p-lbl">Gender</div><div class="p-val">${ge[p?.gender]||'Not set'}</div></div>
        <div class="p-arrow">‚Ä∫</div>
      </div>
      <div class="pr" onclick="showModal('editGoal')">
        <div class="p-ico">üéØ</div>
        <div style="flex:1"><div class="p-lbl">Goal</div><div class="p-val">${gl[p?.goal]||'Not set'}</div></div>
        <div class="p-arrow">‚Ä∫</div>
      </div>
      <div class="pr" onclick="showModal('editWeight')">
        <div class="p-ico">‚öñÔ∏è</div>
        <div style="flex:1"><div class="p-lbl">Weight</div><div class="p-val">${p?.weight||'‚Äî'} ${p?.unit||''}</div></div>
        <div class="p-arrow">‚Ä∫</div>
      </div>
    </div>
    <div class="psec">
      <div class="pr">
        <div class="p-ico">üî•</div>
        <div style="flex:1"><div class="p-lbl">Daily Calorie Goal</div><div class="p-val">${calcGoal(p)} kcal/day (auto-calculated)</div></div>
      </div>
      <div class="pr">
        <div class="p-ico">üìß</div>
        <div style="flex:1"><div class="p-lbl">Email</div><div class="p-val">${S.user?.email}</div></div>
      </div>
      <div class="pr">
        <div class="p-ico">üî•</div>
        <div style="flex:1"><div class="p-lbl">Current Streak</div><div class="p-val">${S.streak} day${S.streak!==1?'s':''}</div></div>
      </div>
    </div>
    <button class="btn-danger" onclick="logout()">üö™ Log Out</button>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ONBOARDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderOB(){
  document.getElementById('app').innerHTML=`<div id="toastEl" class="toast"></div><div class="screen" style="flex:1;display:flex;flex-direction:column;background:#0F0F0F">${obScr(OB[S.step])}</div>`;
}
function obProg(){
  const cur=PS.indexOf(OB[S.step]);if(cur<0)return'';
  return`<div class="pdots">${PS.map((_,i)=>`<div class="pd ${i===cur?'a':i<cur?'d':''}"></div>`).join('')}</div>`;
}
function obHdr(){return`<div class="ob-hdr"><button class="back" onclick="S.step--;renderOB()">‚Üê</button>${obProg()}</div>`;}
function obScr(k){
  const screens={
    splash:`<div class="screen splash" style="flex:1">
      <div class="splash-bg"></div>
      <div class="splash-overlay"></div>
      <div class="splash-content">
        <div class="splash-badge">üî• AI-Powered Fitness</div>
        <div class="splash-title">Cal<span>Fit</span> Ai</div>
        <div class="splash-sub">Your smart nutrition companion. Track meals, log workouts, hit your goals.</div>
        <button class="btn-main" onclick="S.step++;renderOB()">Start your journey ‚Üí</button>
      </div>
    </div>`,
    signup:`<div class="auth-wrap">
      <div class="auth-hero">
        <div class="auth-hero-img"></div>
        <div class="auth-hero-grad"></div>
        <div class="auth-hero-txt">
          <div class="auth-hero-title">${S.authMode==='signup'?'Create Account':'Welcome Back'}</div>
          <div class="auth-hero-sub">${S.authMode==='signup'?'Join thousands reaching their goals':'Great to see you again'}</div>
        </div>
      </div>
      <div class="auth-body">
        <div id="aA" class="alert"></div>
        <div class="inp-label">Email Address</div>
        <input class="inp" id="eI" type="email" placeholder="you@example.com" autocomplete="email"/>
        <div class="inp-label">Password</div>
        <input class="inp" id="pI" type="password" placeholder="Min. 6 characters"/>
        <button class="btn-main" id="aB" onclick="${S.authMode==='signup'?'doSignup()':'doLogin()'}">
          ${S.authMode==='signup'?'Create Account':'Log In'}
        </button>
        <div class="tog-lnk">${S.authMode==='signup'?`Already have an account? <span onclick="toggleAuth()">Log In</span>`:`Don't have an account? <span onclick="toggleAuth()">Sign Up</span>`}</div>
      </div>
    </div>`,
    feat1:`<div class="feat-screen">
      <div class="feat-img-w"><img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=800&q=80" alt=""/><div class="feat-img-grad"></div></div>
      <div class="feat-bot">
        <div class="fdots"><div class="fdot a"></div><div class="fdot"></div></div>
        <div class="feat-t">Eat good without overthinking</div>
        <div class="feat-s">Get personalized meal recommendations based on your goals, preferences and lifestyle.</div>
        <button class="btn-main" onclick="S.step++;renderOB()">Next ‚Üí</button>
      </div>
    </div>`,
    feat2:`<div class="feat-screen">
      <div class="feat-img-w"><img src="https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80" alt=""/><div class="feat-img-grad"></div></div>
      <div class="feat-bot">
        <div class="fdots"><div class="fdot"></div><div class="fdot a"></div></div>
        <div class="feat-t">Track workouts. Burn more. Achieve more.</div>
        <div class="feat-s">Log exercises from our library, track calories burned, and watch your progress every week.</div>
        <button class="btn-main" onclick="S.step++;renderOB()">Get Started ‚Üí</button>
      </div>
    </div>`,
    name:`${obHdr()}<div class="ob-body">
      <div class="ob-tag">Step 1 of 5</div>
      <div class="ob-t">What should we call you?</div>
      <div class="ob-s">We'll use this to personalize your experience.</div>
      <div class="inp-label">Your Name</div>
      <input class="inp" id="nI" placeholder="Enter your first name" value="${S.name}"
        oninput="S.name=this.value;document.getElementById('nxt').disabled=!this.value.trim()" autocomplete="given-name"/>
      <div class="sp"></div>
      <button class="btn-main" id="nxt" onclick="S.step++;renderOB()" ${S.name.trim()?'':'disabled'}>Continue ‚Üí</button>
    </div>`,
    gender:`${obHdr()}<div class="ob-body">
      <div class="ob-tag">Step 2 of 5</div>
      <div class="ob-t">How do you identify?</div>
      <div class="ob-s">This helps us calculate your nutritional needs accurately.</div>
      ${[['male','üë®','Male','He/him'],['female','üë©','Female','She/her'],['other','üßë','Non-binary','They/them']].map(([v,e,l,d])=>`
      <div class="sel-c ${S.gender===v?'on':''}" onclick="S.gender='${v}';renderOB()">
        <div class="av">${e}</div><div style="flex:1"><div class="cl">${l}</div><div class="cd">${d}</div></div>
        ${S.gender===v?`<div class="chk">‚úì</div>`:''}
      </div>`).join('')}
      <div class="sp"></div>
      <button class="btn-main" onclick="S.step++;renderOB()" ${S.gender?'':'disabled'}>Continue ‚Üí</button>
    </div>`,
    source:`${obHdr()}<div class="ob-body">
      <div class="ob-tag">Step 3 of 5</div>
      <div class="ob-t">How did you find us?</div>
      <div class="ob-s">Help us understand how to reach more people like you.</div>
      ${[['tiktok','üéµ','TikTok'],['instagram','üì∑','Instagram'],['facebook','üîµ','Facebook'],['youtube','‚ñ∂Ô∏è','YouTube'],['friends','üë•','Friends & family'],['twitter','‚úñÔ∏è','X / Twitter'],['tv','üì∫','TV / Media']].map(([v,i,l])=>`
      <div class="src-i ${S.source===v?'on':''}" onclick="S.source='${v}';renderOB()">
        <span style="font-size:20px;width:26px;text-align:center">${i}</span>
        <span class="src-lbl">${l}</span>
        ${S.source===v?`<span style="color:var(--o)">‚úì</span>`:''}
      </div>`).join('')}
      <div style="min-height:14px"></div>
      <button class="btn-main" onclick="S.step++;renderOB()" ${S.source?'':'disabled'}>Continue ‚Üí</button>
    </div>`,
    goal:`${obHdr()}<div class="ob-body">
      <div class="ob-tag">Step 4 of 5</div>
      <div class="ob-t">What's your main goal?</div>
      <div class="ob-s">We'll build your entire plan around this.</div>
      ${[['muscle','üí™','Build Muscle','Gain strength and muscle mass'],['healthier','ü•¶','Eat Healthier','Develop better nutrition habits'],['lose','‚öñÔ∏è','Lose Weight','Sustainable fat loss'],['maintain','üéØ','Maintain Weight','Stay at current weight']].map(([v,e,l,d])=>`
      <div class="sel-c ${S.goal===v?'on':''}" onclick="S.goal='${v}';renderOB()">
        <div class="gav">${e}</div><div style="flex:1"><div class="cl">${l}</div><div class="cd">${d}</div></div>
        ${S.goal===v?`<div class="chk">‚úì</div>`:''}
      </div>`).join('')}
      <div class="sp"></div>
      <button class="btn-main" onclick="S.step++;renderOB()" ${S.goal?'':'disabled'}>Continue ‚Üí</button>
    </div>`,
    weight:`${obHdr()}<div class="ob-body">
      <div class="ob-tag">Step 5 of 5</div>
      <div class="ob-t">What's your current weight?</div>
      <div class="ob-s">No judgements ‚Äî helps us set the right calorie goal for you.</div>
      <div class="utog">
        <button class="ub ${S.unit==='kg'?'a':''}" onclick="S.unit='kg';S.weight=70;renderOB()">kg</button>
        <button class="ub ${S.unit==='lbs'?'a':''}" onclick="S.unit='lbs';S.weight=154;renderOB()">lbs</button>
      </div>
      <div class="w-big" id="wn">${S.weight}</div>
      <div style="font-size:14px;color:var(--muted);text-align:center;margin-top:5px;font-weight:700">${S.unit}</div>
      <input type="range" class="wsl" min="${S.unit==='kg'?30:66}" max="${S.unit==='kg'?200:440}"
        value="${S.weight}" oninput="S.weight=parseInt(this.value);document.getElementById('wn').textContent=this.value"/>
      <div style="display:flex;justify-content:space-between;color:#2A2A2A;font-size:10px;font-weight:700">
        <span>${S.unit==='kg'?'30 kg':'66 lbs'}</span><span>${S.unit==='kg'?'200 kg':'440 lbs'}</span>
      </div>
      <div class="sp"></div>
      <button class="btn-main" id="svB" onclick="savePro()">Save & Finish üéâ</button>
    </div>`,
    done:`<div class="suc screen" style="flex:1">
      <div class="suc-bg"></div>
      <div class="suc-grad"></div>
      <div class="suc-content">
        <div class="suc-ring">üéØ</div>
        <div class="suc-title">You're all set, ${S.name||'Champion'}!</div>
        <div class="suc-bub">‚ú® Your plan is built. Daily goal set, workouts ready, meals to track ‚Äî let's go!</div>
        <div class="suc-sub">Your fitness journey starts right now.</div>
        <button class="btn-main" style="width:100%;margin-top:8px" onclick="goApp()">Open my dashboard ‚Üí</button>
      </div>
    </div>`
  };
  return screens[k]||screens.splash;
}

async function goApp(){await loadAll();renderApp();}
init();
</script>
</body>
</html>
